!function(){class Engine{constructor(){this.engines=[],this.sugWord={index:-1,data:[]}}addEngine(engine){engine=JSON.parse(JSON.stringify(engine)),this.engines.push(engine)}engineSug(index){return this.engines[index].suggest}engineCheck(key){return key="number"!=typeof key?+key:key,this.engines[key].url}initSugWord(sugWord){this.sugWord=sugWord}updateSugWord(index){this.sugWord.index=index}}var engines=new Engine;function saveConfig({name:name,value:value,theme:theme}){let config=getConfig()||{};name&&value&&(config.name=name,config.value=value),void 0!==theme&&(config.theme=theme),localStorage.setItem("config",JSON.stringify(config))}function getConfig(){let config;return JSON.parse(localStorage.getItem("config"))}let searchBtn;window.onload=function(){if(fetch("./config.json").then(res=>res.json()).then(data=>{let headerDetail=data["header-detail"],engine=data.engine;console.log("项目地址：",data.github),console.log("网页版本：",data.version),document.querySelector(".header-detail").innerText=headerDetail;let str="";engine.forEach(ele=>{str+=`<div class="engine-item" data-value="${ele.value}">${ele.name}</div>|`,engines.addEngine(ele)}),str=str.slice(0,str.length-1),document.querySelector(".engine-select-content").innerHTML=str}),localStorage.length){let options;showAll(getConfig())}},document.getElementById("search").addEventListener("click",searchEvent);let lock=!1,input=document.getElementById("input-content"),select,themeToggle,sugs;function searchEvent(){let word=document.getElementById("input-content").value.trim();if(word){word=filterWord(word);let key=document.querySelector(".engine-select").getAttribute("data-value"),baseURL,searchURL=engines.engineCheck(key)+word;window.location.href=searchURL}}function filterWord(word){return word=word.replace(" ","+")}function sugEvent(word){if(word){let key=document.querySelector(".engine-select").getAttribute("data-value"),baseURL,jsonpURL=engines.engineSug(key).replace("#content#",filterWord(word)),script=document.createElement("script");script.setAttribute("src",jsonpURL);let scripts=document.querySelectorAll("script");Array.prototype.filter.call(scripts,e=>e.src&&e.src.includes("window.sug")).forEach(e=>{document.body.removeChild(e)}),document.body.appendChild(script)}else showSug([])}function showAll(options){showTheme(options),showEngine(options)}function showEngine(options){if(options.value&&options.name){let select=document.getElementsByClassName("engine-select")[0];select.setAttribute("data-value",options.value),select.innerHTML=options.name}}function showTheme(options){!0!==options.theme||document.body.classList.add("dark")}function showSug(data){let sugBox,classList=document.getElementsByClassName("sugBox")[0].classList;if(data.length&&!classList.contains("active"))classList.add("active");else if(!data.length)return void(classList.contains("active")&&classList.remove("active"));engines.initSugWord({index:-1,data:data});let sugs=document.getElementsByClassName("sugs")[0],str=data.reduce((pre,cur)=>pre+`<li class="sug">${cur}</li>`,"");sugs.innerHTML=str}function showSelectSug(index,length){let sug=document.querySelectorAll(".sug");if(length>1){let pre=index<=0?length-1:index-1,next=index>=length-1?0:index+1;sug[pre].classList.contains("select")&&sug[pre].classList.remove("select"),sug[next].classList.contains("select")&&sug[next].classList.remove("select")}sug[index].classList.add("select"),document.getElementById("input-content").value=sug[index].innerText}input.addEventListener("compositionstart",()=>{lock=!0}),input.addEventListener("compositionend",()=>{lock=!1}),document.getElementsByClassName("engine-select")[0].addEventListener("click",(function(){let selectBox=document.getElementsByClassName("engine-select-box")[0],show=selectBox.classList.contains("active");selectBox.onclick=show?null:function(e){let target;if("engine-item"===e.target.className){let name,value,options={name:e.target.innerHTML,value:e.target.getAttribute("data-value")};return showEngine(options),saveConfig(options),selectBox.classList.remove("active"),void(selectBox.onclick=null)}},selectBox.classList.toggle("active")})),document.querySelector("#theme-toggle").addEventListener("change",(function(){document.body.classList.toggle("dark"),saveConfig({theme:this.checked})})),document.getElementsByClassName("sugs")[0].addEventListener("click",(function(e){let word=e.target.innerText;document.getElementById("input-content").value=word,searchEvent()})),document.onkeyup=function(e){e.preventDefault();var event=e||window.event,key=event.which||event.keyCode||event.charCode;if(13!=+key){if(38==+key||40==+key){let sugBox;if(document.getElementsByClassName("sugBox")[0].classList.contains("active")){let index=engines.sugWord.index,length=engines.sugWord.data.length;if(38==+key)return--index<=-1&&(index=length-1),engines.updateSugWord(index),void showSelectSug(index,length);if(40==+key)return++index===length&&(index=0),engines.updateSugWord(index),void showSelectSug(index,length)}}else if(!lock){let content;sugEvent(document.getElementById("input-content").value.trim())}}else searchEvent()},window.sug={google:function(result){let data;showSug(result[1].map(e=>e[0]))},bing:function(result){let data;data=result.AS.FullResults?result.AS.Results[0].Suggests.map(e=>e.Txt):[],showSug(data)},baidu:function(result){let data=result.s;data.length&&showSug(data)}}}();